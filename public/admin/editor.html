<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Pro - LandingBuilder</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/grapesjs@0.21.2/dist/css/grapes.min.css">
    <script src="https://unpkg.com/grapesjs@0.21.2/dist/grapes.min.js"></script>
    
    <script src="https://unpkg.com/grapesjs-blocks-basic@1.0.1"></script>
    <script src="https://unpkg.com/grapesjs-plugin-forms@2.0.5"></script>
    <script src="https://unpkg.com/grapesjs-navbar@1.0.1"></script>
    <script src="https://unpkg.com/grapesjs-component-countdown@1.0.1"></script>
    <script src="https://unpkg.com/grapesjs-tabs@1.0.6"></script>
    <script src="https://unpkg.com/grapesjs-custom-code@1.0.1"></script>
    <script src="https://unpkg.com/grapesjs-tooltip@0.1.7"></script>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* --- GLOBAL RESET --- */
        body, html { height: 100%; margin: 0; overflow: hidden; font-family: 'Inter', system-ui, sans-serif; background: #ffffff; color: #1e293b; }
        [x-cloak] { display: none !important; }
        
        /* Hapus UI Bawaan */
        .gjs-pn-top-panel, .gjs-pn-views-container, .gjs-pn-views, .gjs-pn-panels, .gjs-pn-buttons { display: none !important; }
        
        /* Canvas */
        .gjs-cv-canvas { width: 100%; height: 100%; top: 0 !important; background-color: #f1f5f9; }
        .gjs-frame-wrapper { box-shadow: 0 0 20px rgba(0,0,0,0.1); }

        /* --- PANEL KANAN --- */
        .panel-tabs { display: flex; border-bottom: 1px solid #e2e8f0; background: #fff; }
        .panel-tabs button { flex: 1; padding: 12px; color: #94a3b8; font-size: 20px; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .panel-tabs button:hover { color: #334155; background: #f8fafc; }
        .panel-tabs button.active { color: #2563eb; border-bottom-color: #2563eb; background: #eff6ff; }

        /* BLOCKS */
        .gjs-blocks-c { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 10px; background: #fff; }
        .gjs-block { width: 100% !important; min-height: auto !important; padding: 15px 5px !important; margin: 0 !important; background: #fff; border: 1px solid #e2e8f0; border-radius: 6px; display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: grab; transition: all 0.15s; }
        .gjs-block:hover { border-color: #3b82f6; color: #2563eb; transform: translateY(-1px); }
        .gjs-block-label { font-size: 10px; font-weight: 600; text-align: center; margin-top: 2px; }
        .gjs-block svg, .gjs-block i { width: 24px; height: 24px; font-size: 24px; fill: currentColor; }
        
        /* CATEGORY */
        .gjs-block-category .gjs-title { background: #f8fafc; border-top: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; padding: 8px 12px; font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase; cursor: pointer; }

        /* INPUTS */
        .gjs-field { background: #fff; border: 1px solid #cbd5e1; border-radius: 4px; padding: 4px; color: #334155; }
        .gjs-field input, .gjs-field select { font-size: 11px; width: 100%; background: transparent; }
        .gjs-sm-sector { border-bottom: 1px solid #e2e8f0; }
        .gjs-sm-title { background: #f8fafc; font-size: 11px; font-weight: 600; color: #475569; padding: 10px 12px; cursor: pointer; display: flex; justify-content: space-between; }
        .gjs-sm-properties { padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; }
        .gjs-sm-property { width: 100%; margin-bottom: 0; }
        .gjs-sm-property__name { font-size: 10px; margin-bottom: 3px; color: #64748b; }
        .gjs-sm-property--width, .gjs-sm-property--height, .gjs-sm-property--color { width: 48%; }
        
        /* LAYERS */
        .gjs-layer-item { padding: 6px 10px; border-bottom: 1px solid #f1f5f9; font-size: 11px; }
        .gjs-layer-item.gjs-selected { background: #eff6ff; color: #2563eb; border-left: 2px solid #2563eb; }
        
        ::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>

<body x-data="editorApp()">

    <header class="h-12 bg-white border-b border-gray-200 flex justify-between items-center px-4 z-50 relative shrink-0">
        <div class="flex items-center gap-3">
            <a href="/admin/pages" class="text-gray-500 hover:text-blue-600 transition p-1.5 rounded hover:bg-gray-100"><i class="ph ph-arrow-left text-lg"></i></a>
            <div class="h-5 w-px bg-gray-200"></div>
            <div class="flex items-center gap-2">
                <span class="text-xs font-bold text-gray-400 font-mono">SLUG:</span>
                <input x-model="page.slug" class="bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs font-bold text-gray-700 outline-none w-32 placeholder-slate-400">
            </div>
        </div>
        <div class="absolute left-1/2 transform -translate-x-1/2 flex items-center bg-gray-50 rounded-lg border border-gray-200 p-0.5">
            <button @click="setDevice('desktop')" :class="device=='desktop'?'bg-blue-50 text-blue-600':'text-gray-400'" class="p-1.5 rounded transition"><i class="ph ph-desktop text-lg"></i></button>
            <button @click="setDevice('tablet')" :class="device=='tablet'?'bg-blue-50 text-blue-600':'text-gray-400'" class="p-1.5 rounded transition"><i class="ph ph-device-tablet text-lg"></i></button>
            <button @click="setDevice('mobile')" :class="device=='mobile'?'bg-blue-50 text-blue-600':'text-gray-400'" class="p-1.5 rounded transition"><i class="ph ph-device-mobile text-lg"></i></button>
            <div class="w-px h-4 bg-gray-300 mx-2"></div>
            <button @click="cmd('core:undo')" class="text-gray-500 hover:text-black p-1.5"><i class="ph ph-arrow-u-up-left text-lg"></i></button>
            <button @click="cmd('core:redo')" class="text-gray-500 hover:text-black p-1.5"><i class="ph ph-arrow-u-up-right text-lg"></i></button>
            <button @click="cmd('core:preview')" class="text-gray-500 hover:text-blue-600 p-1.5"><i class="ph ph-eye text-lg"></i></button>
        </div>
        <div class="flex items-center gap-3">
            <button @click="showSettings=true" class="text-slate-500 hover:text-blue-600 flex items-center gap-1 text-xs font-bold bg-gray-50 px-2 py-1.5 rounded border border-gray-200"><i class="ph ph-gear text-lg"></i> Config</button>
            <button @click="savePage" :disabled="loading" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded text-xs font-bold transition flex items-center gap-2 disabled:opacity-50">
                <i x-show="loading" class="ph ph-spinner animate-spin"></i> <span x-text="loading ? 'Saving...' : 'SIMPAN'"></span>
            </button>
        </div>
    </header>

    <div class="flex h-[calc(100vh-3rem)] overflow-hidden">
        <div class="flex-1 relative bg-gray-100 flex flex-col items-center justify-center p-8 overflow-hidden">
            <div id="gjs" class="flex-1 w-full h-full shadow-lg rounded-sm overflow-hidden border border-gray-300 bg-white"></div>
        </div>
        <div class="w-[300px] bg-white border-l border-gray-200 flex flex-col z-20 shrink-0 shadow-lg">
            <div class="panel-tabs">
                <button @click="tab='blocks'" :class="tab=='blocks'?'active':''" title="Templates"><i class="ph ph-squares-four"></i></button>
                <button @click="tab='styles'" :class="tab=='styles'?'active':''" title="Style"><i class="ph ph-paint-brush"></i></button>
                <button @click="tab='traits'" :class="tab=='traits'?'active':''" title="Settings"><i class="ph ph-sliders-horizontal"></i></button>
                <button @click="tab='layers'" :class="tab=='layers'?'active':''" title="Layers"><i class="ph ph-list-dashes"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto bg-white relative custom-scroll">
                <div x-show="tab=='blocks'" id="blocks-container" class="absolute inset-0 pb-10"></div>
                <div x-show="tab=='styles'"><div id="selectors-container" class="p-2 border-b"></div><div id="styles-container" class="pb-10"></div></div>
                <div x-show="tab=='traits'"><div class="p-3 bg-blue-50 text-blue-700 text-xs font-bold border-b mb-2">PROPERTIES</div><div id="traits-container" class="pb-10 px-2"></div></div>
                <div x-show="tab=='layers'" id="layers-container" class="absolute inset-0 pb-10"></div>
            </div>
        </div>
    </div>

    <div x-show="showSettings" x-cloak class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex justify-end" @click.self="showSettings = false">
        <div class="w-[450px] h-full bg-white shadow-2xl flex flex-col transition-transform duration-300" x-transition:enter="translate-x-full" x-transition:enter-end="translate-x-0" x-transition:leave="translate-x-0" x-transition:leave-end="translate-x-full">
            <div class="p-4 border-b bg-gray-50 flex justify-between items-center"><h2 class="font-bold text-gray-800"><i class="ph ph-faders"></i> Page Config</h2><button @click="showSettings = false"><i class="ph ph-x"></i></button></div>
            <div class="flex-1 overflow-y-auto p-5 space-y-6 custom-scroll">
                <div>
                    <h3 class="text-xs font-bold text-blue-600 uppercase mb-2 border-b pb-1">Product</h3>
                    <div class="flex bg-gray-100 p-1 rounded mb-3">
                        <button @click="page.product_type='physical'" :class="page.product_type=='physical'?'bg-white shadow':''" class="flex-1 py-1 text-xs font-bold rounded transition">Fisik</button>
                        <button @click="page.product_type='digital'" :class="page.product_type=='digital'?'bg-white shadow':''" class="flex-1 py-1 text-xs font-bold rounded transition">Digital</button>
                    </div>
                    <div x-show="page.product_type==='physical'"><label class="text-[10px] font-bold text-gray-500">Berat (gr)</label><input x-model="page.config.shipping.weight" type="number" class="w-full border rounded p-1.5 text-xs"></div>
                    <div class="mt-2"><label class="text-[10px] font-bold text-gray-500">Variants</label><template x-for="(v, i) in page.config.variants"><div class="flex gap-1 mb-1"><input x-model="v.name" class="flex-1 border rounded px-2 text-xs"><input x-model="v.price" type="number" class="w-20 border rounded px-2 text-xs"><button @click="page.config.variants.splice(i,1)" class="text-red-500"><i class="ph ph-trash"></i></button></div></template><button @click="addVariant" class="text-xs text-blue-600 font-bold">+ Add Variant</button></div>
                </div>
                <div>
                    <h3 class="text-xs font-bold text-green-600 uppercase mb-2 border-b pb-1">SEO & Social</h3>
                    <div class="space-y-2">
                        <input x-model="page.config.settings.seo_title" class="w-full border rounded p-1.5 text-xs" placeholder="Page Title">
                        <textarea x-model="page.config.settings.seo_description" class="w-full border rounded p-1.5 text-xs" rows="2" placeholder="Description"></textarea>
                        <input x-model="page.config.settings.favicon" class="w-full border rounded p-1.5 text-xs font-mono" placeholder="Favicon URL">
                        <input x-model="page.config.settings.og_image" class="w-full border rounded p-1.5 text-xs font-mono" placeholder="OG Image URL">
                    </div>
                </div>
                <div>
                    <h3 class="text-xs font-bold text-gray-600 uppercase mb-2 border-b pb-1">API Key</h3>
                    <select x-model="cred.provider" class="w-full border rounded p-1.5 text-xs mb-2"><option value="midtrans">Midtrans</option><option value="cloudinary">Cloudinary</option></select>
                    <textarea x-model="cred.data" class="w-full border rounded p-1.5 text-xs font-mono" rows="3" placeholder='JSON Config'></textarea>
                    <button @click="saveCreds" class="w-full bg-slate-800 text-white py-1.5 rounded text-xs font-bold mt-2">Simpan Key</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // LOGIKA UNTUK MENAMBAH BARIS OTOMATIS
                const addTableLogic = (editor) => {
                    editor.DomComponents.addType('comparison-table-wrapper', {
                        model: {
                            defaults: {
                                traits: [
                                    {
                                        type: 'button',
                                        text: '+ Tambah Baris Baru',
                                        full: true,
                                        command: (editor) => {
                                            const selected = editor.getSelected();
                                            const tbody = selected.find('tbody')[0];
                                            if (tbody) {
                                                tbody.append(`
                                                    <div style="display:flex; padding:20px; border-bottom:1px solid #f1f5f9; align-items:center; text-align:center;">
                                                        <div style="flex:1; text-align:left; font-weight:bold; color:#475569; padding-left:10px;">Fitur Baru</div>
                                                        <div style="flex:1; color:#16a34a; font-weight:bold; display:flex; flex-direction:column; align-items:center;">
                                                            <i class="ph ph-check-circle" style="font-size:24px;"></i>
                                                            <span style="font-size:12px;">Kelebihan</span>
                                                        </div>
                                                        <div style="flex:1; color:#94a3b8; display:flex; flex-direction:column; align-items:center;">
                                                            <i class="ph ph-x-circle" style="font-size:24px;"></i>
                                                            <span style="font-size:12px;">Kekurangan</span>
                                                        </div>
                                                    </div>
                                                `);
                                            }
                                        },
                                    }
                                ],
                            },
                        },
                    });
                };
        function editorApp() {
            return {
                loading: false, showSettings: false, device: 'desktop', tab: 'blocks',
                page: { slug: '', title: '', product_type: 'physical', config: { variants:[], shipping:{weight:1000}, settings:{} } },
                cred: { provider: 'midtrans', data: '' },
                authPass: localStorage.getItem('admin_pass'),

                init() {
                    const params = new URLSearchParams(window.location.search);
                    this.page.slug = params.get('slug');
                    if(!this.authPass) window.location.href='/login';
                    this.initGrapes();
                },

                setDevice(d) { this.device=d; window.editor.setDevice(d); },
                cmd(c) { window.editor.runCommand(c); },
                addVariant() { this.page.config.variants.push({id:Date.now(), name:'', price:0}) },
                
                async saveCreds() {
                    try { await fetch('/api/admin/credentials', {method:'POST', headers:{'Authorization':this.authPass}, body:JSON.stringify({provider:this.cred.provider, data:JSON.parse(this.cred.data)})}); alert('Tersimpan!'); } catch(e){ alert('JSON Salah'); }
                },
                async savePage() {
                    this.loading=true;
                    try { await fetch('/api/admin/pages', {method:'POST', headers:{'Authorization':this.authPass}, body:JSON.stringify({slug:this.page.slug, title:this.page.title, product_type:this.page.product_type, html:editor.getHtml(), css:editor.getCss(), product_config:this.page.config})}); alert('Berhasil!'); } catch(e){ alert('Gagal'); }
                    this.loading=false;
                },
                
                initGrapes() {
                    setTimeout(() => {
                        window.editor = grapesjs.init({
                            container: '#gjs', height: '100%', fromElement: false, storageManager: false,
                            plugins: ['gjs-blocks-basic', 'grapesjs-plugin-forms', 'grapesjs-navbar', 'grapesjs-component-countdown', 'grapesjs-tabs', 'grapesjs-custom-code', 'grapesjs-tooltip'],
                            pluginsOpts: { 'gjs-blocks-basic': { flexGrid: true } },
                            deviceManager: { devices: [{id:'desktop',width:''}, {id:'tablet',width:'768px'}, {id:'mobile',width:'375px'}] },
                            blockManager: { appendTo: '#blocks-container' },
                            layerManager: { appendTo: '#layers-container' },
                            selectorManager: { appendTo: '#styles-container' },
                            traitManager: { appendTo: '#traits-container' },
                            styleManager: { appendTo: '#styles-container', sectors: [{ name: 'Typography', open: true, buildProps: ['font-family', 'font-size', 'font-weight', 'line-height', 'color', 'text-align'] }, { name: 'Dimensions', open: false, buildProps: ['width', 'height', 'max-width', 'min-height', 'padding', 'margin'] }, { name: 'Layout', open: false, buildProps: ['display', 'flex-direction', 'justify-content', 'align-items', 'gap'] }, { name: 'Decorations', open: false, buildProps: ['background-color', 'border', 'border-radius', 'box-shadow'] }] },
                            
                            // ------------------------------------
                            // ASSET MANAGER (BASE64 UPLOAD FIX)
                            // ------------------------------------
                            assetManager: { 
                                upload: false,
                                autoAdd: true,
                                uploadFile: async (e) => {
                                    const files = e.dataTransfer ? e.dataTransfer.files : e.target.files;
                                    for(let i=0; i<files.length; i++){
                                        const file = files[i];
                                        const reader = new FileReader();
                                        reader.readAsDataURL(file);
                                        reader.onload = async () => {
                                            try {
                                                const res = await fetch('/api/admin/upload-image', {
                                                    method:'POST',
                                                    headers: { 'Content-Type': 'application/json', 'Authorization': localStorage.getItem('admin_pass') },
                                                    body: JSON.stringify({ image: reader.result, filename: file.name })
                                                });
                                                const json = await res.json();
                                                if(json.data) window.editor.AssetManager.add(json.data);
                                                else alert(json.message || 'Upload Gagal');
                                            } catch(err) { console.error(err); alert('Koneksi Gagal'); }
                                        };
                                    }
                                }
                            }
                        });
                        addTableLogic(window.editor);
                        // ------------------------------------
                        // CUSTOM BLOCKS (HEADER IMAGE LOGO)
                        // ------------------------------------
                        const bm = editor.BlockManager;

                        // LAYOUTS
                        bm.add('container-fluid', { label: 'Container (Fluid)', category: 'Layout', attributes: {class:'ph ph-arrows-out-line-horizontal'}, content: `<div style="width:90%; max-width:1200px; margin:0 auto; padding:20px; min-height:50px;"></div>` });
                        bm.add('container-full', { label: 'Container (Full)', category: 'Layout', attributes: {class:'ph ph-arrows-out-simple'}, content: `<div style="width:100%; padding:20px; min-height:50px;"></div>` });
                        bm.add('section-std', { label: 'Section', category: 'Layout', attributes: {class:'ph ph-square'}, content: `<section style="padding:60px 0; background-color:#fff;"><div style="width:90%; max-width:1100px; margin:0 auto;"></div></section>` });

                        // HEADER DENGAN IMAGE LOGO (PLACEHOLDER)
                        bm.add('header-simple', { 
                            label: 'Header Logo', category: 'Headers', attributes:{class:'ph ph-list'}, 
                            content: `<header style="padding:15px 20px; border-bottom:1px solid #eee; display:flex; justify-content:center; align-items:center;">
                                        <img src="https://via.placeholder.com/150x50?text=LOGO" style="height:40px; object-fit:contain;" alt="Logo" />
                                      </header>` 
                        });
                        bm.add('header-left', { 
                            label: 'Header Left', category: 'Headers', attributes:{class:'ph ph-sidebar-simple'}, 
                            content: `<header style="padding:15px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee;">
                                        <img src="https://via.placeholder.com/150x50?text=LOGO" style="height:40px; object-fit:contain;" alt="Logo" />
                                        <nav><a href="#" style="margin-left:15px; color:#333; text-decoration:none;">Home</a><a href="#" style="margin-left:15px; color:#333; text-decoration:none;">Contact</a></nav>
                                      </header>` 
                        });
                        bm.add('header-right', { 
                            label: 'Header Right', category: 'Headers', attributes:{class:'ph ph-sidebar-simple'}, 
                            content: `<header style="padding:15px 20px; display:flex; flex-direction:row-reverse; justify-content:space-between; align-items:center; border-bottom:1px solid #eee;">
                                        <img src="https://via.placeholder.com/150x50?text=LOGO" style="height:40px; object-fit:contain;" alt="Logo" />
                                        <nav><a href="#" style="margin-right:15px; color:#333; text-decoration:none;">Home</a></nav>
                                      </header>` 
                        });
                        bm.add('header-center', { 
                            label: 'Header Center', category: 'Headers', attributes:{class:'ph ph-align-center-horizontal-simple'}, 
                            content: `<header style="padding:20px; text-align:center; border-bottom:1px solid #eee;">
                                        <img src="https://via.placeholder.com/150x50?text=LOGO" style="height:50px; margin-bottom:10px; object-fit:contain;" alt="Logo" />
                                        <nav style="display:block;"><a href="#" style="margin:0 10px; color:#333;">Home</a><a href="#" style="margin:0 10px; color:#333;">About</a></nav>
                                      </header>` 
                        });

                        // CONTENT TEMPLATES
                        bm.add('hero-tpl', { 
                            label: 'Hero Section', category: 'Templates', attributes:{class:'ph ph-layout'}, 
                            content: `<section style="padding:80px 20px; text-align:center; background:#f8fafc;"><h1 style="font-size:3rem; margin-bottom:20px; color:#1e293b;">Judul Hero Menarik</h1><p style="font-size:1.2rem; color:#64748b; margin-bottom:30px; max-width:700px; margin-left:auto; margin-right:auto;">Subjudul yang menjelaskan value proposition produk Anda.</p><a href="#" style="padding:12px 30px; background:#2563eb; color:white; border-radius:5px; text-decoration:none; font-weight:bold;">Call to Action</a></section>` 
                        });
                        bm.add('features-tpl', {
                            label: 'Features 3-Col', category: 'Templates', attributes:{class:'ph ph-grid-three'},
                            content: `<section style="padding:60px 20px;"><div style="max-width:1100px; margin:0 auto; display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:30px;"><div style="text-align:center; padding:20px; border:1px solid #eee; border-radius:8px;"><h3>Fitur 1</h3><p>Deskripsi singkat.</p></div><div style="text-align:center; padding:20px; border:1px solid #eee; border-radius:8px;"><h3>Fitur 2</h3><p>Deskripsi singkat.</p></div><div style="text-align:center; padding:20px; border:1px solid #eee; border-radius:8px;"><h3>Fitur 3</h3><p>Deskripsi singkat.</p></div></div></section>`
                        });
                        // TEMPLATE PRICELIST (DAFTAR HARGA)
                        bm.add('pricelist-tpl', {
                            label: 'Pricelist 3-Col',
                            category: 'Templates',
                            attributes: { class: 'ph ph-tag' },
                            content: `<section style="padding:60px 20px; background-color:#f1f5f9; width:100%; box-sizing:border-box;">
                                <div style="max-width:1100px; margin:0 auto; display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">
                                    <div style="background:#fff; padding:40px 20px; border-radius:12px; text-align:center; border:1px solid #e2e8f0;">
                                        <h4 style="margin:0; color:#64748b; text-transform:uppercase; font-size:12px; font-weight:bold;">Paket Hemat</h4>
                                        <div style="font-size:32px; font-weight:800; margin:15px 0;">Rp 99.000</div>
                                        <ul style="list-style:none; padding:0; margin:20px 0; color:#475569; font-size:14px; line-height:2;">
                                            <li>Fitur Dasar</li>
                                            <li>Support Email</li>
                                            <li>Update 1 Bulan</li>
                                        </ul>
                                        <a href="#" style="display:block; background:#2563eb; color:#fff; padding:12px; border-radius:6px; text-decoration:none; font-weight:bold;">Pilih Paket</a>
                                    </div>
                                    <div style="background:#fff; padding:40px 20px; border-radius:12px; text-align:center; border:2px solid #2563eb; transform:scale(1.05); position:relative;">
                                        <span style="position:absolute; top:-12px; left:50%; transform:translateX(-50%); background:#2563eb; color:#fff; padding:2px 12px; border-radius:20px; font-size:10px; font-weight:bold;">TERLARIS</span>
                                        <h4 style="margin:0; color:#64748b; text-transform:uppercase; font-size:12px; font-weight:bold;">Paket Premium</h4>
                                        <div style="font-size:32px; font-weight:800; margin:15px 0;">Rp 199.000</div>
                                        <ul style="list-style:none; padding:0; margin:20px 0; color:#475569; font-size:14px; line-height:2;">
                                            <li>Semua Fitur Dasar</li>
                                            <li>Support Prioritas</li>
                                            <li>Update Selamanya</li>
                                        </ul>
                                        <a href="#" style="display:block; background:#2563eb; color:#fff; padding:12px; border-radius:6px; text-decoration:none; font-weight:bold;">Pilih Paket</a>
                                    </div>
                                    <div style="background:#fff; padding:40px 20px; border-radius:12px; text-align:center; border:1px solid #e2e8f0;">
                                        <h4 style="margin:0; color:#64748b; text-transform:uppercase; font-size:12px; font-weight:bold;">Paket Bisnis</h4>
                                        <div style="font-size:32px; font-weight:800; margin:15px 0;">Rp 499.000</div>
                                        <ul style="list-style:none; padding:0; margin:20px 0; color:#475569; font-size:14px; line-height:2;">
                                            <li>Custom Domain</li>
                                            <li>Support 24/7</li>
                                            <li>Akses Eksklusif</li>
                                        </ul>
                                        <a href="#" style="display:block; background:#2563eb; color:#fff; padding:12px; border-radius:6px; text-decoration:none; font-weight:bold;">Pilih Paket</a>
                                    </div>
                                </div>
                            </section>`
                        });
                        
                        // TEMPLATE KOMPARASI (PERBANDINGAN)
                        bm.add('comparison-tpl', {
                            label: 'Comparison Table',
                            category: 'Templates',
                            attributes: { class: 'ph ph-scales' },
                            content: `<section style="padding:60px 20px; width:100%; box-sizing:border-box;">
                                <div style="max-width:900px; margin:0 auto;">
                                    <table style="width:100%; border-collapse:collapse; border:1px solid #e2e8f0; text-align:left; font-size:14px;">
                                        <thead>
                                            <tr style="background:#f8fafc;">
                                                <th style="padding:15px; border:1px solid #e2e8f0;">FITUR</th>
                                                <th style="padding:15px; border:1px solid #e2e8f0; text-align:center;">PRODUK KAMI</th>
                                                <th style="padding:15px; border:1px solid #e2e8f0; text-align:center; color:#94a3b8;">PRODUK LAIN</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="padding:15px; border:1px solid #e2e8f0; font-weight:bold;">Kualitas Bahan</td>
                                                <td style="padding:15px; border:1px solid #e2e8f0; text-align:center; color:#16a34a; font-weight:bold;">Premium Grade A</td>
                                                <td style="padding:15px; border:1px solid #e2e8f0; text-align:center;">Biasa</td>
                                            </tr>
                                            <tr style="background:#f8fafc;">
                                                <td style="padding:15px; border:1px solid #e2e8f0; font-weight:bold;">Garansi</td>
                                                <td style="padding:15px; border:1px solid #e2e8f0; text-align:center; color:#16a34a; font-weight:bold;">1 Tahun Ganti Baru</td>
                                                <td style="padding:15px; border:1px solid #e2e8f0; text-align:center;">7 Hari</td>
                                            </tr>
                                            <tr>
                                                <td style="padding:15px; border:1px solid #e2e8f0; font-weight:bold;">Harga</td>
                                                <td style="padding:15px; border:1px solid #e2e8f0; text-align:center; color:#16a34a; font-weight:bold;">Sangat Terjangkau</td>
                                                <td style="padding:15px; border:1px solid #e2e8f0; text-align:center;">Mahal</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </section>`
                        });

                        // Head to Head
                        bm.add('comparison-head-to-head', {
                        label: 'Comparison Modern',
                        category: 'Templates',
                        attributes: { class: 'ph ph-shield-check' },
                        content: {
                            type: 'comparison-table-wrapper', // Menghubungkan ke logika tombol tadi
                            content: `<section style="padding:80px 20px; background:#f8fafc; width:100%; box-sizing:border-box;">
                                <div style="max-width:800px; margin:0 auto; background:#fff; border-radius:30px; overflow:hidden; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1);">
                                    <div style="display:flex; background:#1e293b; color:#fff; padding:25px; text-align:center;">
                                        <div style="flex:1; font-weight:bold; font-size:18px;">FITUR</div>
                                        <div style="flex:1; font-weight:bold; font-size:18px; color:#3b82f6;">KAMI</div>
                                        <div style="flex:1; font-weight:bold; font-size:18px; opacity:0.5;">LAIN</div>
                                    </div>
                                    <div class="table-body-area">
                                        <div style="display:flex; padding:20px; border-bottom:1px solid #f1f5f9; align-items:center; text-align:center;">
                                            <div style="flex:1; text-align:left; font-weight:bold; color:#475569; padding-left:10px;">Contoh Fitur</div>
                                            <div style="flex:1; color:#16a34a; font-weight:bold; display:flex; flex-direction:column; align-items:center;">
                                                <i class="ph ph-check-circle" style="font-size:24px;"></i>
                                                <span style="font-size:12px;">Ya</span>
                                            </div>
                                            <div style="flex:1; color:#94a3b8; display:flex; flex-direction:column; align-items:center;">
                                                <i class="ph ph-x-circle" style="font-size:24px;"></i>
                                                <span style="font-size:12px;">Tidak</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>`
                        }
                    });
                        // WIDGETS
                        bm.add('video-yt', { label: 'YouTube', category: 'Media', attributes:{class:'ph ph-youtube-logo'}, content: { type: 'video', provider: 'yt', style: { height: '350px', width: '100%' } } });
                        bm.add('custom-code-blk', { label: 'Custom HTML', category: 'Extra', attributes:{class:'ph ph-code'}, content: { type: 'custom-code', content: '' } });
                        bm.add('checkout-pro', { label: 'Form Checkout', category: 'E-Commerce', attributes:{class:'ph ph-shopping-cart'}, content: `<div data-gjs-type="checkout-widget" style="padding:20px; border:2px dashed #3b82f6; background:#eff6ff; text-align:center; border-radius:8px;"><strong style="color:#1e40af;">[ FORM CHECKOUT ]</strong><p style="font-size:12px; color:#64748b;">Akan muncul saat live.</p></div>` });

                        editor.on('load', () => {
                            editor.Canvas.getBody().style.backgroundColor = '#ffffff';
                            if(this.page.slug) {
                                fetch('/api/admin/pages/'+this.page.slug).then(r=>r.json()).then(d=>{
                                    if(d.id) {
                                        this.page.title=d.title; this.page.product_type=d.product_type||'physical';
                                        try{ this.page.config=JSON.parse(d.product_config_json||'{}'); }catch(e){ this.page.config={variants:[],settings:{}}; }
                                        if(!this.page.config.settings) this.page.config.settings={seo_title:d.title};
                                        if(!this.page.config.shipping) this.page.config.shipping={weight:1000};
                                        if(d.html_content) editor.setComponents(d.html_content);
                                        if(d.css_content) editor.setStyle(d.css_content);
                                    }
                                });
                            }
                        });
                    }, 100);
                }
            }
        }
    </script>
</body>
</html>
