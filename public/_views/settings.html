<!DOCTYPE html>
<html lang="id">
<head>
    <title>Settings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="/js/layout.js"></script>
</head>
<body>
    <admin-layout>
        <div x-data="settingsApp()" x-init="init()" class="max-w-4xl">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">Pengaturan Sistem</h2>

            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border dark:border-gray-700 mb-6">
                <h3 class="font-bold text-lg mb-4 text-gray-800 dark:text-white flex items-center gap-2">
                    <i class="ph ph-globe text-blue-500"></i> Homepage
                </h3>
                <div class="flex gap-4">
                    <input x-model="homepageSlug" type="text" placeholder="Masukkan slug halaman..." class="flex-1 px-4 py-2 border rounded-lg bg-gray-50 dark:bg-gray-900 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-blue-500">
                    <button @click="saveHomepage" class="bg-gray-900 dark:bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:opacity-90 transition">Simpan</button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border dark:border-gray-700">
                <h3 class="font-bold text-lg mb-4 text-gray-800 dark:text-white flex items-center gap-2">
                    <i class="ph ph-plugs text-green-500"></i> Integrasi API
                </h3>
                
                <div class="mb-4">
                    <label class="block text-xs font-bold text-gray-500 mb-2">PROVIDER</label>
                    <select x-model="cred.provider" class="w-full px-4 py-2 border rounded-lg bg-gray-50 dark:bg-gray-900 dark:border-gray-600 dark:text-white outline-none">
                        <option value="midtrans">Midtrans (Payment)</option>
                        <option value="rajaongkir">RajaOngkir (Shipping)</option>
                        <option value="cloudinary">Cloudinary (Image)</option>
                        <option value="whatsapp">WhatsApp (Manual)</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="block text-xs font-bold text-gray-500 mb-2">JSON CONFIGURATION</label>
                    <textarea x-model="cred.data" rows="6" class="w-full px-4 py-3 bg-gray-900 text-green-400 font-mono text-xs rounded-lg border border-gray-700 outline-none focus:border-green-500" placeholder='{ "server_key": "SB-Mid-...", "client_key": "..." }'></textarea>
                </div>

                <div class="flex justify-end">
                    <button @click="saveCreds" class="bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700 transition flex items-center gap-2">
                        <i class="ph ph-check-circle"></i> Simpan Konfigurasi
                    </button>
                </div>
            </div>
        </div>

        <script>
            function settingsApp() {
                return {
                    homepageSlug: '',
                    cred: { provider: 'midtrans', data: '' },
                    token: localStorage.getItem('admin_pass'),
                    
                    async init() {
                        try {
                            const res = await fetch('/api/admin/homepage-slug');
                            const data = await res.json();
                            if(data.slug) this.homepageSlug = data.slug;
                        } catch(e) {}
                    },

                    async saveHomepage() {
                        await fetch('/api/admin/set-homepage', {
                            method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': this.token},
                            body: JSON.stringify({slug: this.homepageSlug})
                        });
                        alert('Homepage tersimpan!');
                    },

                    async saveCreds() {
                        try {
                            const parsed = JSON.parse(this.cred.data);
                            await fetch('/api/admin/credentials', {
                                method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': this.token},
                                body: JSON.stringify({provider: this.cred.provider, data: parsed})
                            });
                            alert('Konfigurasi tersimpan aman!');
                            this.cred.data = '';
                        } catch(e) { alert('JSON Tidak Valid!'); }
                    }
                }
            }
        </script>
    </admin-layout>
</body>
</html>
